# Инструкция по запуску и проверке новой функциональности

## 1. Установка зависимостей

### Сервер
```bash
cd /Users/nemkoff/Desktop/HELPDESK/HELPDESK/server
npm install
# node-cron уже установлена
```

### Клиент
```bash
cd /Users/nemkoff/Desktop/HELPDESK/HELPDESK/client
npm install
```

## 2. Запуск приложения

### Терминал 1 - Сервер
```bash
cd /Users/nemkoff/Desktop/HELPDESK/HELPDESK/server
npm start
# или для разработки:
npm run dev
```

Сервер запустится на порту 5001 и активирует крон-задачу для проверки доступности сайтов.

### Терминал 2 - Клиент
```bash
cd /Users/nemkoff/Desktop/HELPDESK/HELPDESK/client
npm start
```

Приложение откроется на http://localhost:3000

## 3. Быстрая проверка функциональности

### Шаг 1: Авторизация администратора
1. Открыть приложение по адресу http://localhost:3000/login
2. Логин: `admin@obsidian.ru`
3. Пароль: `admin123`

### Шаг 2: Перейти к управлению виджетами
1. Перейти в раздел "Администрирование" → "Клиенты"
2. Выбрать любого клиента (или создать нового)
3. На странице клиента нажать кнопку **"Управлять виджетами"**

### Шаг 3: Протестировать каждый виджет

#### 3.1 Виджет "Статус рекламных кампаний"
1. Вкладка "Рекламные кампании"
2. Включить чекбокс "Включить виджет"
3. Заполнить "Текущий месячный бюджет" (например, 50000)
4. Заполнить "Рекомендованный бюджет" (например, 75000)
5. Выбрать статус (Активна/На паузе/Остановлена)
6. Нажать "Сохранить"
7. **Проверка на клиенте:** Выйти из аккаунта, авторизоваться как клиент и перейти на Dashboard - виджет должен отображаться с соответствующей пульсацией

#### 3.2 Виджет "Календарь обязательных обновлений"
1. Вкладка "Календарь обновлений"
2. Включить чекбокс "Включить виджет"
3. Заполнить даты (используйте даты в будущем, в прошлом и близкие)
   - Домен: например, через 30 дней
   - Хостинг: например, через 90 дней
   - SSL: либо дата, либо галочка "Обновляется автоматически"
4. Нажать "Сохранить"
5. **Проверка на клиенте:** На Dashboard должны появиться даты с цветовыми индикаторами

#### 3.3 Виджет "Рекомендации"
1. Вкладка "Рекомендации"
2. Включить чекбокс "Включить виджет"
3. Нажать "Сохранить"
4. В разделе "Добавить рекомендацию" заполнить:
   - Тема: "Обновить базы данных"
   - Описание: "Необходимо обновить версию MySQL до 8.0"
   - Стоимость: 5000
5. Нажать "Добавить рекомендацию"
6. Повторить для ещё 1-2 рекомендаций
7. **Проверка на клиенте:** На Dashboard виджет покажет количество рекомендаций, можно нажать на любую и "Принять" - создастся новый тикет

#### 3.4 Виджет "Доступность сайта"
1. Вкладка "Доступность сайта"
2. Включить чекбокс "Включить виджет"
3. Заполнить URL сайта (например, https://google.com)
4. Нажать "Сохранить"
5. **Проверка на клиенте:** Виджет появится на Dashboard с сообщением "Проверка будет проведена в 04:00"
6. **Автоматическая проверка:** Каждый день в 04:00 по времени сервера будет проверяться доступность. Для тестирования можно вручную запустить проверку через API:
   ```bash
   curl -X POST http://localhost:5001/api/widgets/site-availability/1 \
     -H "Authorization: Bearer YOUR_TOKEN" \
     -H "Content-Type: application/json" \
     -d '{"enabled": true, "site_url": "https://google.com"}'
   ```

## 4. Тестирование от лица клиента

### Авторизация клиента
1. Логин: посмотреть в приложении или создать новый через администратора
   - Дефолтные учётные данные клиента должны быть созданы администратором
   - Если нет - на странице клиента нажать "Создать логин"

2. На Dashboard клиента должны отображаться все активные виджеты в одном месте

## 5. Проверка API endpoints

Можно использовать Postman или curl для проверки API:

```bash
# Получить виджет рекламных кампаний
curl http://localhost:5001/api/widgets/ad-campaign/1 \
  -H "Authorization: Bearer YOUR_TOKEN"

# Создать/обновить виджет рекламных кампаний
curl -X POST http://localhost:5001/api/widgets/ad-campaign/1 \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "enabled": true,
    "monthly_budget": 50000,
    "recommended_budget": 75000,
    "status": "active"
  }'

# Получить рекомендации
curl http://localhost:5001/api/widgets/recommendations/1 \
  -H "Authorization: Bearer YOUR_TOKEN"

# Добавить рекомендацию
curl -X POST http://localhost:5001/api/widgets/recommendations/1/add \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Обновить PHP",
    "description": "Обновить PHP до версии 8.2",
    "cost": 3000
  }'

# Принять рекомендацию (от клиента)
curl -X POST http://localhost:5001/api/widgets/recommendations/1/accept \
  -H "Authorization: Bearer CLIENT_TOKEN"
```

## 6. Возможные проблемы и их решение

### Проблема: Крон-задача не запускается
**Решение:** Убедитесь, что сервер запущен. Задача запускается в 04:00 по времени сервера каждый день.

### Проблема: Ошибка при сохранении виджета
**Решение:** Проверьте наличие интернета (для проверки доступности сайтов) и корректность заполненных данных.

### Проблема: Виджеты не отображаются на Dashboard
**Решение:** 
1. Убедитесь, что виджет включен (чекбокс "Включить виджет")
2. Очистите кэш браузера (Ctrl+Shift+Delete или Cmd+Shift+Delete)
3. Перезагрузите страницу

### Проблема: Рекомендация не создаёт тикет
**Решение:** Проверьте, что вы авторизованы как клиент и что рекомендация активна.

## 7. Импортные файлы и директории

- **БД:** `/Users/nemkoff/Desktop/HELPDESK/HELPDESK/server/helpdesk.db`
- **Скриншоты:** `/Users/nemkoff/Desktop/HELPDESK/HELPDESK/server/uploads/screenshots/`
- **Логи сервера:** `/Users/nemkoff/Desktop/HELPDESK/HELPDESK/server/server.log` (если настроена запись логов)

## 8. Дополнительно

Все компоненты компилируются и работают без ошибок. При необходимости можно дополнительно:

1. Добавить более сложную логику проверки сайтов (screenshot через сторонний API)
2. Расширить систему рекомендаций (категории, приоритеты и т.д.)
3. Добавить отправку уведомлений клиентам при изменении статусов
4. Настроить отправку email-уведомлений о приближающихся датах продления
